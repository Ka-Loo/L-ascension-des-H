<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Cours Guitare - Ascension Pentatonique</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .fretboard-wrapper { display: flex; background: #2d1b10; padding: 25px; border-radius: 10px; border: 2px solid #444; box-shadow: 0 10px 30px rgba(0,0,0,0.5); position: relative; }
        .labels { display: flex; flex-direction: column-reverse; justify-content: space-between; height: 180px; margin-right: 15px; font-weight: bold; color: #aaa; padding: 5px 0; }
        
        /* Le manche avec son sillet à gauche */
        .fretboard { display: flex; background: #3d2b1f; border-left: 6px solid #888; position: relative; height: 180px; }
        
        /* Chaque frette est bien délimitée par border-right */
        .fret-column { 
            display: flex; flex-direction: column-reverse; 
            border-right: 2px solid #666; 
            width: 65px; height: 100%; 
            justify-content: space-around; position: relative; 
            z-index: 2;
        }
        
        .fret-num { position: absolute; bottom: -25px; width: 100%; text-align: center; font-size: 12px; color: #888; }
        
        .dot { position: absolute; background: rgba(255,255,255,0.15); width: 14px; height: 14px; border-radius: 50%; left: 50%; transform: translateX(-50%); z-index: 0; }
        .dot.double-top { top: 25%; }
        .dot.double-bottom { bottom: 25%; }
        .dot.single { top: 50%; transform: translate(-50%, -50%); }

        /* Les cordes passent par-dessus tout */
        .string-line { position: absolute; left: 0; width: 100%; height: 2px; background: rgba(200,200,200,0.3); z-index: 1; pointer-events: none; }

        .note { width: 22px; height: 22px; border-radius: 50%; margin: 0 auto; z-index: 5; transition: 0.3s; display: flex; align-items: center; justify-content: center; font-size: 0px; border: 1px solid transparent; background: transparent; }
        .h1 { background: #3498db !important; box-shadow: 0 0 12px #3498db; border-color: white; }
        .h2 { background: #2ecc71 !important; box-shadow: 0 0 12px #2ecc71; border-color: white; }
        .h3 { background: #9b59b6 !important; box-shadow: 0 0 12px #9b59b6; border-color: white; }
        .root-final { background: #e67e22 !important; box-shadow: 0 0 18px #e67e22; border: 2px solid white; transform: scale(1.0); }

        .slide-text { position: absolute; font-size: 10px; font-weight: bold; color: white; padding: 2px 6px; border-radius: 3px; border: 1px solid white; z-index: 25; pointer-events: none; transform: translate(-50%, -50%); white-space: nowrap; }
        .h-line { position: absolute; z-index: 4; pointer-events: none; height: 2px; transform-origin: left center; }

        .controls { margin-top: 50px; display: flex; gap: 15px; flex-direction: column; align-items: center;}
        .btns { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
        button { padding: 12px 20px; cursor: pointer; background: #333; color: white; border: 1px solid #555; border-radius: 6px; font-weight: bold; }
        button:hover { background: #444; }
        #btn-full { background: #4a4a4a; border-color: #888; }
        .tip { font-size: 12px; color: #666; margin-top: 10px; }
    </style>
</head>
<body>

    <h2>L'Ascension Pentatonique : Motif en "h"</h2>
    <p>Exemple : gamme pentatonique majeure de La</p>

    <div class="fretboard-wrapper">
        <div class="labels"><span>E</span><span>A</span><span>D</span><span>G</span><span>B</span><span>e</span></div>
        <div id="fretboard" class="fretboard">
            <div class="string-line" style="top: 15px;"></div>
            <div class="string-line" style="top: 45px;"></div>
            <div class="string-line" style="top: 75px;"></div>
            <div class="string-line" style="top: 104px;"></div>
            <div class="string-line" style="top: 134px;"></div>
            <div class="string-line" style="top: 164px;"></div>
        </div>
    </div>

    <div class="controls">
        <div class="btns">
            <button id="btn-main" onclick="startAnim(true)">Lancer l'animation</button>
            <button id="btn-pause" onclick="togglePause()">⏸ / ▶</button>
            <button id="btn-full" onclick="showFullPattern()">Voir le motif complet</button>
        </div>
        <div class="tip">Appuyez sur <strong>Espace</strong> pour Play/Pause</div>
    </div>

    <script>
        const board = document.getElementById('fretboard');
        let timer = null, currentIndex = 0, paused = false, started = false;

        window.addEventListener('keydown', e => { if(e.code === 'Space') { e.preventDefault(); togglePause(); } });

        // Génération des colonnes de frettes
        for(let f=4; f<=18; f++) {
            let col = document.createElement('div');
            col.className = 'fret-column';
            col.id = `fret-col-${f}`;

            // Points de repère
            if([5, 7, 9, 15, 17].includes(f)) {
                let d = document.createElement('div'); d.className = 'dot single'; col.appendChild(d);
            } else if(f === 12) {
                let d1 = document.createElement('div'); d1.className = 'dot double-top'; col.appendChild(d1);
                let d2 = document.createElement('div'); d2.className = 'dot double-bottom'; col.appendChild(d2);
            }

            // Zones pour les notes
            for(let s=0; s<6; s++) {
                let n = document.createElement('div'); n.className = 'note'; n.id = `s${s}-f${f}`;
                col.appendChild(n);
            }
            let num = document.createElement('div'); num.className = 'fret-num'; num.innerText = f;
            col.appendChild(num);
            board.appendChild(col);
        }

        const trajet = [
            {s:0,f:5,c:'h1'}, {s:0,f:7,c:'h1'}, {slide:true,s:0,targetX:8,col:'#3498db'}, {s:0,f:9,c:'h1'}, {s:1,f:7,c:'h1'}, {s:1,f:9,c:'h1',drawH:true,color:'#3498db',wait:1000},
            {s:2,f:7,c:'h2'}, {s:2,f:9,c:'h2'}, {slide:true,s:2,targetX:10,col:'#2ecc71'}, {s:2,f:11,c:'h2'}, {s:3,f:9,c:'h2'}, {s:3,f:11,c:'h2',drawH:true,color:'#2ecc71',wait:1000},
            {s:4,f:10,c:'h3'}, {s:4,f:12,c:'h3'}, {slide:true,s:4,targetX:13,col:'#9b59b6'}, {s:4,f:14,c:'h3'}, {s:5,f:12,c:'h3'}, {s:5,f:14,c:'h3',drawH:true,color:'#9b59b6'},
            {slide:true,s:5,targetBetween:[15,16],col:'#e67e22'}, {s:5,f:17,c:'root-final',drawH:true,color:'#e67e22'}
        ];

        function resetBoard() {
            clearTimeout(timer);
            document.querySelectorAll('.note').forEach(n=>n.className='note');
            document.querySelectorAll('.slide-text, .h-line').forEach(el=>el.remove());
            currentIndex = 0; paused = false; started = false;
        }

        function startAnim(reset) {
            if(reset) resetBoard();
            if(!started) {
                started = true;
                document.getElementById('btn-main').innerText = "Relancer l'animation";
                nextStep();
            }
        }

        function drawSlide(step) {
            const t=document.createElement('div'); t.className='slide-text'; t.innerText='GLISSÉ'; t.style.backgroundColor=step.col;
            let targetCol = step.targetBetween ? document.getElementById(`fret-col-${step.targetBetween[0]}`) : document.getElementById(`fret-col-${step.targetX}`);
            let px = targetCol.offsetLeft + (step.targetBetween ? 48 : 32);
            t.style.left=px+"px"; 
            t.style.top=(document.getElementById(`s${step.s}-f4`).offsetTop + 11)+"px";
            board.appendChild(t);
        }

        function showFullPattern() {
            resetBoard();
            trajet.forEach((step, index) => {
                if(step.slide) {
                    drawSlide(step);
                } else {
                    const el = document.getElementById(`s${step.s}-f${step.f}`);
                    if(el) el.classList.add(step.c);
                    if(step.drawH) {
                        if(step.c === 'root-final') {
                            drawLine(`s5-f${trajet[index-2].f}`, `s5-f${step.f}`, step.color);
                        } else {
                            const s=step.s-1, f1=trajet[index-5].f, f2=trajet[index-4].f, f3=trajet[index-2].f, f4=trajet[index-1].f;
                            drawLine(`s${s}-f${f1}`,`s${s}-f${f2}`,step.color); drawLine(`s${s}-f${f2}`,`s${s}-f${f3}`,step.color);
                            drawLine(`s${s}-f${f2}`,`s${step.s}-f${f4}`,step.color); drawLine(`s${step.s}-f${f4}`,`s${step.s}-f${step.f}`,step.color);
                        }
                    }
                }
            });
            started = true;
            document.getElementById('btn-main').innerText = "Relancer l'animation";
        }

        function togglePause() { if(!started) startAnim(false); else paused = !paused; }

        function drawLine(idS, idE, col) {
            const s=document.getElementById(idS), e=document.getElementById(idE), l=document.createElement('div');
            l.className='h-line'; const x1=s.offsetLeft+11+s.parentElement.offsetLeft, y1=s.offsetTop+11, x2=e.offsetLeft+11+e.parentElement.offsetLeft, y2=e.offsetTop+11;
            const dist=Math.sqrt((x2-x1)**2+(y2-y1)**2), ang=Math.atan2(y2-y1,x2-x1)*180/Math.PI;
            l.style.width=dist+"px"; l.style.left=x1+"px"; l.style.top=y1+"px"; l.style.transform=`rotate(${ang}deg)`; l.style.backgroundColor=col; l.style.boxShadow=`0 0 5px ${col}`; board.appendChild(l);
        }

        function nextStep() {
            if(currentIndex>=trajet.length) return; if(paused){ timer=setTimeout(nextStep,100); return; }
            let step=trajet[currentIndex];
            if(step.slide){
                drawSlide(step);
                currentIndex++; timer=setTimeout(nextStep, 700);
            } else {
                const el=document.getElementById(`s${step.s}-f${step.f}`); if(el) el.classList.add(step.c);
                if(step.drawH){
                    if(step.c === 'root-final') {
                        drawLine(`s5-f${trajet[currentIndex-2].f}`, `s5-f${step.f}`, step.color);
                    } else {
                        const s=step.s-1, f1=trajet[currentIndex-5].f, f2=trajet[currentIndex-4].f, f3=trajet[currentIndex-2].f, f4=trajet[currentIndex-1].f;
                        drawLine(`s${s}-f${f1}`,`s${s}-f${f2}`,step.color); drawLine(`s${s}-f${f2}`,`s${s}-f${f3}`,step.color);
                        drawLine(`s${s}-f${f2}`,`s${step.s}-f${f4}`,step.color); drawLine(`s${step.s}-f${f4}`,`s${step.s}-f${step.f}`,step.color);
                    }
                }
                currentIndex++; timer=setTimeout(nextStep, step.wait||500);
            }
        }
    </script>
</body>
</html>
